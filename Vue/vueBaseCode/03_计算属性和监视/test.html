<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>03_计算属性和监视</title>
  </head>
  <body>
    <!--
      1. 计算属性
        在computed属性对象中定义计算属性的方法
        在页面中使用{{方法名}}来显示计算的结果
      2. 监视属性:
        通过通过vm对象的$watch()或watch配置来监视指定的属性
        当属性变化时, 回调函数自动调用, 在函数内部进行计算
      3. 计算属性高级:
        通过getter/setter实现对属性数据的显示和监视
        计算属性存在缓存, 多次读取只执行一次getter计算
    -->
    <div id="app">
      姓:
      <input type="text" placeholder="First Name" v-model="firstName" /><br />
      名: <input type="text" placeholder="Last Name" v-model="lastName" /><br />
      姓名-双向绑定:
      <input type="text" placeholder="Full Name1" v-model="fullname" /><br />
      姓名-只读属性:
      <input
        type="text"
        placeholder="Full Name2"
        :value="fullnameOnlyRead"
      /><br />
      姓名-watch:
      <input type="text" placeholder="Full Name2" :value="watchName" /><br />
    </div>

    <script type="text/javascript" src="../js/vue.js"></script>
    <script type="text/javascript">
      const vm = new Vue({
        el: "#app",
        data: {
          firstName: "chen",
          lastName: "guanxi",
          watchName: "watch name",
        },
        // 计算属性会监视内部使用过的属性的变化, 一旦发生变化, 计算属性就要重新计算
        computed: {
          // 给vm定义一个属性，叫fullName
          fullname: {
            // fullname属性读取的方法
            get() {
              // vue内部会对data/methods/computed等属性进行数据代理(将对象中的属性挂载到vm上),就能直接通过vm/this直接访问属性
              return this.firstName + " " + this.lastName;
            },
            // fullname属性设置的方法
            set(newVal) {
              // console.log(newVal); //最新的值
              const [firstName, lastName] = newVal.split(" ");
              // vue可以直接更新data数据, 同时用户界面也会发生变化(响应式)
              (this.firstName = firstName), (this.lastName = lastName);
            },
          },
          // 只读的计算属性(不能修改),这个方法相对于fullName1的get方法,没有set
          fullnameOnlyRead() {
            return this.firstName + " " + this.lastName;
          },
        },
        // 监视属性,监视data中的属性,一旦发生变化,就会调用相应的函数
        watch: {
          firstName(newVal) {
            // console.log(newVal); //firstName变化的值
            const res = this.watchName.split(" ");
            res[0] = newVal;
            // console.log(res); //["chen111", "name"]
            this.watchName = res.join(" ");
          },
          lastName(newVal) {
            // console.log(newVal); //lastName变化的值
            const res = this.watchName.split(" ");
            res[1] = newVal;
            this.watchName = res.join(" ");
          },
        },
      });
      console.log(vm);
    </script>
  </body>
</html>
